<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Document</title>
		<link rel="stylesheet" href="css/css.css">
		<style type="text/css">
			#content1 ul .wd_div img {
				border-radius: 50%;
				position: absolute;
				left: 4px;
				top: 11px;
			}
		</style>
		<script src="js/jquery-1.11.2.js"></script>
		<script src="js/js.js"></script>
		<script type="text/javascript">
			$(function() {
				var page = 1; //页数
				var pagecount = 1; //总页数
				var rescount = 0; //记录数
				$.ajax({
					url: "fenye.php",
					type: "POST",
					dataType: "json",
					success: function(data) {
						rescount = data;
						// console.log(rescount); //8
						pagecount = Math.ceil(rescount / 5);
						// console.log(pagecount); //2
					}
				});
				$.ajaxSetup({
					type: "POST",
					dataType: "json"
				})
				//下一页
				$("#wd_down").click(function() {
					if (page >= pagecount) {
						page = pagecount;
					} else {
						page = page + 1;
					}
					console.log(page);
					if (page <= pagecount) {
						$.ajax({
							url: "wd_fbly1.php?page=" + page,
							success: function(data) {
								// console.log(typeof data);
								// var data = JSON.parse(data);
								data = data.data;
								console.log("data.data", data);
								var str = "<ul>";
								// console.log(data[0].author);
								// 对数据进行遍历
								for (var i = 0 in data) {
									str +=
										"<div class='wd_div'><li><p class='wd_yh'>用户：[<span class='spf_author'>" +
										data[i]
										.author + "</span>]" +
										"<img src='img/face/" + data[i].face + "' width='50'>" +
										" <span class='spf_time'>时间：" + data[i].addTime +
										"</span></p>" +
										"<p class='spf_title'>" + data[i].title + "</p>" +
										"<div class='wd_nr'>内容：</div><div class='wd_nr1'>" + data[i]
										.content + "</li></div></div>";
										if (data[i].reply) {
											str += "<p class='wd_p1'>" + "管理员回复：" + data[i].reply + "</p>";
										}
									// if(data[i].reply){
									// 	str+=+"管理员回复："+data[i].reply+"</li></div>";
									// }
								}
								// 输出信息
								$("#content1").html(str + "</ul>");
							}
						})
					}

				})

				//上一页
				$("#wd_up").click(function() {
					if (page <= 1) {
						page = 1;
					} else {
						page = page - 1;
					}
					console.log(page);
					if (page <= pagecount) {
						$.ajax({
							url: "wd_fbly1.php?page=" + page,
							success: function(data) {
								console.log(data);
								// var data = JSON.parse(data);
								data = data.data;
								// console.log("data.data",data);
								var str = "<ul>";
								// console.log(data[0].author);
								// 对数据进行遍历
								for (var i = 0 in data) {
									str +=
										"<div class='wd_div'><li><p class='wd_yh'>用户：[<span class='spf_author'>" +
										data[i]
										.author + "</span>]" +
										"<img src='img/face/" + data[i].face + "' width='50'>" +
										"<span class='spf_time'> 时间：" + data[i].addTime +
										"</span></p>" +
										"<p class='spf_title'>" + data[i].title + "</p>" +
										"<div class='wd_nr'>内容：</div><div class='wd_nr1'>" + data[i]
										.content + "</li></div></div>";
										if (data[i].reply) {
											str += "<p class='wd_p1'>" + "管理员回复：" + data[i].reply + "</p>";
										}
									// if(data[i].reply){
									// 	str+=+"管理员回复："+data[i].reply+"</li></div>";
									// }
								}
								// 输出信息
								$("#content1").html(str + "</ul>");
							}
						})
					}

				})


				//发布留言开始
				let facestr = "";
				for (let i = 1; i <= 20; i++) {
					facestr += '<option value="' + i + '.jpg">' + i + ".jpg" + '</option>';
				}

				$("#fabu form #face").html(facestr).change(function() {
					let _this = $(this);
					$("#img1").attr("src", "img/face/" + _this.val());
				})
				$("#bt1").click(function() {
					$.ajax({
						url: "wd_fbly.php",
						type: "POST",
						dataType: "json",
						data: {
							userName: $("#userName").val(),
							face: $("#face").val(),
							title: $("#title").val(),
							area1: $("#area1").val()
						},
						success: function(data) {
							if (data.status == "10001") {
								alert(data.msg)
							} else {
								alert(data.msg)
							}
						}
					})
				})
				$.ajax({
					url: "wd_fbly1.php?page=" + page,
					dataType: "json",
					success: function(data) {
						// console.log(data);
						data = data.data;
						// console.log(data[0].messageId);.
						var str = "<ul>";
						// console.log(data[0].author);
						// 对数据进行遍历
						for (var i = 0 in data) {
							str += "<div class='wd_div'><li><p class='wd_yh'>用户：[<span class='spf_author'>" +
								data[i]
								.author + "</span>]" +
								"<img src='img/face/" + data[i].face + "' width='50'>" +
								" <span class='spf_time'>时间：" + data[i].addTime + "</span></p>" +
								"<p class='spf_title'>" + data[i].title + "</p>" +
								"<div class='wd_nr'>内容：</div><div class='wd_nr1'>" + data[i].content +
								"</li></div></div>";
								if (data[i].reply) {
									str += "<p class='wd_p1'>" + "管理员回复：" + data[i].reply + "</p>";
								}
							// if(data[i].reply){
							// 	str+=+"管理员回复："+data[i].reply+"</li></div>";
							// }
						}
						// 输出信息
						$("#content1").html(str + "</ul>");
					}
				});
				//发布留言结束
			})
		</script>
	</head>

	<body>
		<div class="head">
			<div class="head1">
				<a href="" class="a1">首页</a>
				<a href="login.html" class="a2">管理员登录</a>
			</div>
		</div>
		<div class="content">
			<div class="content1" id="content1">

			</div>
			<div id="huanye">
				<a href="javascript:;" id="wd_up">上一页</a>
				<a href="javascript:;" id="wd_down">下一页</a>
			</div>

		</div>
		<div id="fabu">
			<p id="p1">发 布 留 言</p>
			<form action="" autocomplete="off">
				作者:
				<input type="text" id="userName">
				头像：
				<select name="face" id="face">

				</select>
				<img src="img/face/1.jpg" alt="" width="50" id="img1"><br>
				标题:
				<input type="text" id="title"><br>
				内容
				<textarea id="area1" cols="30" rows="10"></textarea>
				<input type="button" id="bt1" value="发布留言">
			</form>
		</div>
	</body>

</html>
