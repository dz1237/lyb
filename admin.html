<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Document</title>
		<link rel="stylesheet" href="css/css.css">
		<style type="text/css">
			div.zz {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				bottom: 0;
				right: 0;
				background-color: rgba(0, 0, 0, 0.7);
			}

			div.hf {
				display: none;
				position: absolute;
				top: 40%;
				left: 40%;
				opacity: 0.8;
				z-index: 1;
			}

			div.hf textarea {
				outline: none;
				border-radius: 20px;
				padding: 20px;
				font-size: 16px;
			}

			span#wd_gb {
				background-color: #FFFFFF;
				/* display: block; */
				cursor: pointer;
			}
		</style>
		<script src="js/jquery-1.11.2.js"></script>
		<script src="js/js.js"></script>
		<script type="text/javascript">
			$(function() {

				$.ajax({
					url: "admins.php",
					type: "POST",
					cache: false,
					headers: {
						//request header 中发送
						"X-token": localStorage.getItem("jwt")
					},
					dataType: "json",
					success: function(data) {
						if (data.result == "success") {
							$("#span9").text(data.info.data.userName);
						} else {
							location.href = "login.html"
						}
					}
				})
				$(".a3").click(function() {
					alert("")
					localStorage.removeItem("jwt");
					// location.href="login.html";
				})

				var page = 1; //页数
				var pagecount = 1; //总页数
				var rescount = 0; //记录数
				$.ajax({
					url: "fenye.php",
					type: "POST",
					dataType: "json",
					success: function(data) {
						rescount = data;
						// console.log(rescount); //8
						pagecount = Math.ceil(rescount / 5);
						// console.log(pagecount); //2
					}
				});
				$.ajaxSetup({
					type: "POST",
					dataType: "json"
				})
				//下一页
				$("#wd_down").click(function() {
					if (page >= pagecount) {
						page = pagecount;
					} else {
						page = page + 1;
					}
					console.log(page);
					if (page <= pagecount) {
						$.ajax({
							url: "wd_fbly2.php?page=" + page,
							success: function(data) {
								// console.log(data);
								data = data.data;
								// console.log(data);
								var str = "<ul>";
								// console.log(data[0].author);
								// 对数据进行遍历
								for (var i = 0 in data) {
									str += "<div class='wd_div'> <a href='#' class='del' data_Id=" + data[i]
										.messageId +
										">删除</a>";
									if (data[i].sh == 0) {
										str+= "<a href='javascript:;' class='wd_sh' data_id=" + data[i].messageId +
											">未审核</a>"
									} else {
										 str+="<a href='javascript:;' class='wd_sh' data_id=" + data[i].messageId +
											">已审核</a>"
									}
									str+="<a href='#' class='wd_huifu' data_Id=" + data[i]
										.messageId + ">回复</a>  <li><p class='wd_yh'>用户：[<span class='spf_author'>" +
										data[i]
										.author + "</span>]" +
										"<img src='img/face/" + data[i].face + "' width='50'>" +
										" <span class='spf_time'>时间：" + data[i].addTime + "</span></p>" +
										"<p class='spf_title'>" + data[i].title + "</p>" +
										"<div class='wd_nr'>内容：</div><div class='wd_nr1'>" + data[i].content +
										"</li></div></div>";
									if (data[i].reply) {
										str += "<p class='wd_p1'>" + "管理员回复：" + data[i].reply + "</p>";
									}
								}
								// 输出信息
								$("#content1").html(str + "</ul>");
							}
						})
					}

				})

				//上一页
				$("#wd_up").click(function() {
					if (page <= 1) {
						page = 1;
					} else {
						page = page - 1;
					}
					console.log(page);
					if (page <= pagecount) {
						$.ajax({
							url: "wd_fbly2.php?page=" + page,
							success: function(data) {
								// console.log(data);
								data = data.data;
								// console.log(data);
								var str = "<ul>";
								// console.log(data[0].author);
								// 对数据进行遍历
								for (var i = 0 in data) {
									str += "<div class='wd_div'> <a href='#' class='del' data_Id=" + data[i]
										.messageId +
										">删除</a>";
									if (data[i].sh == 0) {
										str+= "<a href='javascript:;' class='wd_sh' data_id=" + data[i].messageId +
											">未审核</a>"
									} else {
										 str+="<a href='javascript:;' class='wd_sh' data_id=" + data[i].messageId +
											">已审核</a>"
									}
									str+="<a href='#' class='wd_huifu' data_Id=" + data[i]
										.messageId + ">回复</a>  <li><p class='wd_yh'>用户：[<span class='spf_author'>" +
										data[i]
										.author + "</span>]" +
										"<img src='img/face/" + data[i].face + "' width='50'>" +
										" <span class='spf_time'>时间：" + data[i].addTime + "</span></p>" +
										"<p class='spf_title'>" + data[i].title + "</p>" +
										"<div class='wd_nr'>内容：</div><div class='wd_nr1'>" + data[i].content +
										"</li></div></div>";
									if (data[i].reply) {
										str += "<p class='wd_p1'>" + "管理员回复：" + data[i].reply + "</p>";
									}
								}
								// 输出信息
								$("#content1").html(str + "</ul>");
							}
						})
					}

				})


				//发布留言开始
				let facestr = "";
				for (let i = 1; i <= 20; i++) {
					facestr += '<option value="' + i + '.jpg">' + i + ".jpg" + '</option>';
				}

				$("#fabu form #face").html(facestr).change(function() {
					let _this = $(this);
					$("#img1").attr("src", "img/face/" + _this.val());
				})
				//点击发布留言
				$("#bt1").click(function() {

					$.ajax({
						url: "wd_fbly.php",
						type: "POST",
						dataType: "json",
						data: {
							userName: $("#userName").val(),
							face: $("#face").val(),
							title: $("#title").val(),
							area1: $("#area1").val()
						},
						success: function(data) {

							if (data.status == "10001") {
								alert(data.msg)

							} else {
								alert(data.msg)
							}
							$("#userName").val(""),
								$("#face").val(),
								$("#title").val(""),
								$("#area1").val("")
							location.href = "admin.html"
						}
					})
				})
				$.ajax({
					url: "wd_fbly2.php?page=" + page,
					dataType: "json",
					success: function(data) {
						// console.log(data);
						data = data.data;
						// console.log(data);
						var str = "<ul>";
						// console.log(data[0].author);
						// 对数据进行遍历
						for (var i = 0 in data) {
							str += "<div class='wd_div'> <a href='#' class='del' data_Id=" + data[i]
								.messageId +
								">删除</a>";
							if (data[i].sh == 0) {
								str+= "<a href='javascript:;' class='wd_sh' data_id=" + data[i].messageId +
									">未审核</a>"
							} else {
								 str+="<a href='javascript:;' class='wd_sh' data_id=" + data[i].messageId +
									">已审核</a>"
							}
							str+="<a href='#' class='wd_huifu' data_Id=" + data[i]
								.messageId + ">回复</a>  <li><p class='wd_yh'>用户：[<span class='spf_author'>" +
								data[i]
								.author + "</span>]" +
								"<img src='img/face/" + data[i].face + "' width='50'>" +
								" <span class='spf_time'>时间：" + data[i].addTime + "</span></p>" +
								"<p class='spf_title'>" + data[i].title + "</p>" +
								"<div class='wd_nr'>内容：</div><div class='wd_nr1'>" + data[i].content +
								"</li></div></div>";
							if (data[i].reply) {
								str += "<p class='wd_p1'>" + "管理员回复：" + data[i].reply + "</p>";
							}
						}
						// 输出信息
						$("#content1").html(str + "</ul>");
					}
				});
				//发布留言结束
				$(document).on("click", ".wd_huifu", function() {
					var _this = $(this)
					$(".zz").show();
					$(".hf").show();
					$("#hf1").click(function() {
						$.ajax({
							url: "huifu.php",
							type: "POST",
							dataType: "json",
							data: {
								messageId: _this.attr("data_Id"),
								reply: $("#reply").val()
							},
							success: function(data) {
								console.log(data);
								if (data.status == "10001") {
									alert(data.msg);
									location.href = "admin.html";
								} else {
									alert(data.msg);
								}
								$(".zz").hide();
								$(".hf").hide();
							}

						})
					})
				})
				$("#wd_gb").click(function() {
					$(".zz").hide();
					$(".hf").hide();
				})
				//删除留言
				$(document).on("click", ".del", function() {
					var _this = $(this)
					$.ajax({
						url: "del.php",
						data: {
							messageId: _this.attr("data_Id")
						},
						success: function(data) {
							if (data.status == '10001') {
								alert("删除成功");
								location.href = "admin.html";
							} else {
								alert(data.msg)
							}
						}
					})
				})
				//审核留言
				$(document).on("click", ".wd_sh", function() {
					var _this = $(this);
					$.ajax({
						url: "sh.php",
						data: {
							messageId: _this.attr("data_Id")
						},
						success: function(data) {
							if (data.status == '10001') {
								alert("审核成功");
								location.href = "admin.html";
							} else {
								alert(data.msg);
							}
						}
					})
				})
			})
		</script>
	</head>

	<body>
		<div class="head">
			<div class="head1">
				<a href="" class="a1">首页</a>
				<a class="a2">管理员【<span id="span9"></span>】登录</a>
				<a href="" class="a3">注销</a>
			</div>
		</div>
		<div class="content">
			<div class="content1" id="content1">

			</div>
			<div id="huanye">
				<a href="javascript:;" id="wd_up">上一页</a>
				<a href="javascript:;" id="wd_down">下一页</a>
			</div>

		</div>
		<div id="fabu">
			<p id="p1">发 布 留 言</p>
			<form action="" autocomplete="off">
				作者:
				<input type="text" id="userName">
				头像：
				<select name="face" id="face">

				</select>
				<img src="img/face/1.jpg" alt="" width="50" id="img1"><br>
				标题:
				<input type="text" id="title"><br>
				内容
				<textarea id="area1" cols="30" rows="10"></textarea>
				<input type="button" id="bt1" value="发布留言">
			</form>

		</div>

		<div class="zz">

		</div>
		<div class="hf">
			<span id="wd_gb">
				关闭
			</span>
			<textarea rows="10" cols="30" id="reply"></textarea>
			<input type="button" id="hf1" value="回复" />
		</div>

	</body>

</html>
